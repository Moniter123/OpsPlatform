{% extends 'bootstrap.html' %}

{% block content %}
    {{ data | safe }}
    <div class="row-fluid">
            <div class="span11">
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="height:400px"></div>
    <!-- ECharts单文件引入 -->
    <script src="{{ url_for('static',filename='assets/js/echarts.js')}} "></script>
    <script src="{{ url_for('static',filename='assets/js/jquery.js') }}"></script>
    <script src="{{ url_for('static',filename='assets/js/echarts-all.js')}} "></script>
    <script type="text/javascript">
        // 路径配置
        require.config({
            paths: {
                'echarts': 'http://echarts.baidu.com/build/dist'
            }
        });

        // 使用
        require(
            [
                'echarts',
                'echarts/chart/pie'
            ],
            function (ec) {
                // 基于准备好的dom，初始化echarts图表

                myChart = ec.init(document.getElementById('main'));
                var option = {
                    title : {
                        text: '某站点用户访问来源',
                        subtext: '纯属虚构',
                        x:'center'
                    },
                    tooltip : {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient : 'vertical',
                        x : 'left',
                        data:[]
                    },
                    toolbox: {
                        show : true,  //是否开启工具栏
                        feature : {
                            mark : {show: true},
                            dataView : {show: true, readOnly: false},
                            magicType : {
                                show: true,
                                type: ['pie', 'funnel'],
                                option: {
                                    funnel: {
                                        x: '25%',
                                        width: '50%',
                                        funnelAlign: 'left',
                                        max: 1548
                                    }
                                }
                            },
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    series : []
                };
                    // 载入动画---------------------
                    myChart.showLoading({
                        text: '正在努力的读取数据中...'   //loading话术
                    });

                   // 定时器
                   window.onload=function(){
                   //每隔2秒检查一下数据
                   window.setInterval(checkStatus,2000);
                   };

                function checkStatus() {
                    // ajax 加载数据
                    $.ajax({
                        url: '/dataapi/query3api',  //
                        type: 'post',
                        contentType: "application/json;charset=UTF-8",
                        dataType: "json",
                        data: {},
                        success: function (data) {


                            var legendData = [];
                            var seriesData = [];


                            if (data != null && data["series"].length > 0) {
                                legendData = data["legen"];
                                seriesData.push({
                                    "name": "test",
                                    "type": "pie",
                                    "radius": '65%',   //饼图半径大小
                                    "center": ['50%', '60%'],//饼图圆心位置x,y
                                    "data": function () {
                                        var t_data = [];
                                        for (var i = 0, len = data["series"].length; i < len; i++) {
                                            t_data.push({
                                                "name": legendData[i],
                                                "value": data["series"][i]
                                            });
                                        }
                                        return t_data;
                                    }()
                                });
                            }

                            option.legend.data = legendData;
                            myChart.setOption(option);
                            myChart.setSeries(seriesData);
                        },

                        error: function () {
                            var legendData = [''];
                            var seriesData = [
                                {
                                    "name": "饼图标例1",
                                    "type": "pie",
                                    "radius": '55%',   //饼图半径大小
                                    "center": ['50%', '60%'],//饼图圆心位置x,y
                                    data: [0]
                                }
                            ];
                            option.legend.data = legendData;
                            myChart.setOption(option);
                            myChart.setSeries(seriesData);

                        },
                        complete: function () {
                            //停止动画载入提示
                            myChart.hideLoading();
                        }
                    });
                }
            }

        );

    </script>
    </div>



        </div>

<hr>
{#    {{ data }}#}
    <div class="row-fluid">
        <div class="span6">
            <div class="row">
                    <div class="hero-unit">
                        <h1>Hello, {{ current_user.username }}</h1>
                        <div><p><b>{{ current_user.username }} says: </b> {{ posts.body }}</p></div>
                        <p><a href="#" class="btn btn-primary btn-large">Learn more &raquo;</a></p>
                    </div>
                </div>
        </div>

         <div class="span6">
            <div class="row">
                    <div class="hero-unit">
                        <h1>Hello, {{ current_user.username }}</h1>
                        <div><p><b>{{ current_user.username }} says: </b> {{ posts.body }}</p></div>
                        <p><a href="#" class="btn btn-primary btn-large">Learn more &raquo;</a></p>
                    </div>
                </div>
        </div>
    </div>

{% endblock %}