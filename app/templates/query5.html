{% extends 'bootstrap.html' %}

{% block content %}

{#    <div class="row-fluid">#}
{#            <div class="span6">#}
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
        <div class="row-fluid">
            <div class="span6">
                <div id="barMain" style="height:300px"></div>
          </div>
            <div class="span6">
                <div id="lineMain" style="height:300px"></div>
            </div>
        </div>

    <!-- ECharts单文件引入 -->
    <script src="{{ url_for('static',filename='assets/js/echarts.js')}} "></script>
    <script src="{{ url_for('static',filename='assets/js/jquery.js') }}"></script>
    <script src="{{ url_for('static',filename='assets/js/echarts-all.js')}} "></script>
    <script type="text/javascript">
        // 路径配置
        require.config({
            paths: {
                'echarts': 'http://echarts.baidu.com/build/dist'
            }
        });

        // 使用
        require(
            [
                'echarts',
                'echarts/chart/pie',
                'echarts/chart/line'
            ],
                drawEcharts
        );
        function drawEcharts(ec){
            drawBar(ec);
            drawLine(ec);
        }
            function drawBar(ec) {
                // 基于准备好的dom，初始化echarts图表

                myChart = ec.init(document.getElementById('barMain'));
                var option = {
                    title : {
                        text: 'query5',
                        subtext: '纯属虚构',
                        x:'center'
                    },
                    tooltip : {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient : 'vertical',
                        x : 'left',
                        data:[]
                    },
                    toolbox: {
                        show : true,  //是否开启工具栏
                        feature : {
                            mark : {show: true},
                            dataView : {show: true, readOnly: false},
                            magicType : {
                                show: true,
                                type: ['pie', 'funnel'],
                                option: {
                                    funnel: {
                                        x: '25%',
                                        width: '50%',
                                        funnelAlign: 'left',
                                        max: 1548
                                    }
                                }
                            },
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    series : []
                };
                    // 载入动画---------------------
                    myChart.showLoading({
                        text: '正在努力的读取数据中...'   //loading话术
                    });

                   // 定时器
                   window.onload=function(){
                   //每隔2秒检查一下数据
                   window.setInterval(checkStatus,2000);
                   };

                function checkStatus() {
                    // ajax 加载数据
                    $.ajax({
                        url: '/dataapi/query3api',  //
                        type: 'post',
                        contentType: "application/json;charset=UTF-8",
                        dataType: "json",
                        async:false,

                        data: {},
                            success: function (data) {


                            var legendData = [];
                            var seriesData = [];


                            if (data != null && data["series"].length > 0) {
                                legendData = data["legen"];
                                seriesData.push({
                                    "name": "ss",
                                    "type": "pie",
                                    "radius": '65%',   //饼图半径大小
                                    "center": ['50%', '60%'],//饼图圆心位置x,y
                                    "data": function () {
                                        var t_data = [];
                                        for (var i = 0, len = data["series"].length; i < len; i++) {
                                            t_data.push({
                                                "name": legendData[i],
                                                "value": data["series"][i]
                                            });
                                        }
                                        return t_data;
                                    }()
                                });
                            }

                            option.legend.data = legendData;
                            myChart.setOption(option);
                            myChart.setSeries(seriesData);
                        },

                        error: function () {
                            var legendData = [''];
                            var seriesData = [
                                {
                                    "name": "tst",
                                    "type": "pie",
                                    "radius": '55%',   //饼图半径大小
                                    "center": ['50%', '60%'],//饼图圆心位置x,y
                                    data: [0]
                                }
                            ];
                            option.legend.data = legendData;
                            myChart.setOption(option);
                            myChart.setSeries(seriesData);

                        },
                        complete: function () {
                            //停止动画载入提示
                            myChart.hideLoading();
                        }
                    });
                }
            }

function drawLine(ec){
　　var myLineChart = ec.init(document.getElementById('lineMain'));
　　var option2 = {
　　　　title : {
　　　　text: '未来一周气温变化',
　　　　subtext: '纯属虚构'
　　},
　　tooltip : {
　　　　trigger: 'axis'
　　},
　　legend: {
　　　　data:['最高气温','最低气温']
　　},
　　toolbox: {
　　　　show : true,
　　　　feature : {
　　　　　　mark : {show: true},
　　　　　　dataView : {show: true, readOnly: false},
　　　　　　magicType : {show: true, type: ['line', 'bar']},
　　　　　　restore : {show: true},
　　　　　　saveAsImage : {show: true}
　　　　}
　　},
　　calculable : true,
　　xAxis : [
　　　　{
　　　　　　type : 'category',
　　　　　　boundaryGap : false,
　　　　　　data : ['周一','周二','周三','周四','周五','周六','周日']
　　　　}
　　],
　　yAxis : [
　　　　{
　　　　　　type : 'value',
　　　　　　axisLabel : {
　　　　　　　　formatter: '{value} °C'
　　　　　　}
　　　　}
　　],
　　series : [
　　　　{
　　　　　　name:'最高气温',
　　　　　　type:'line',
　　　　　　data:[11, 11, 15, 13, 12, 13, 10],
　　　　　　markPoint : {
　　　　　　　　data : [
　　　　　　　　　　{type : 'max', name: '最大值'},
　　　　　　　　　　{type : 'min', name: '最小值'}
　　　　　　　　]
　　　　　　},
　　　　　　markLine : {
　　　　　　　　data : [
　　　　　　　　　　{type : 'average', name: '平均值'}
　　　　　　　　]
　　　　　　}
　　　　},
　　　　{
　　　　　　name:'最低气温',
　　　　　　type:'line',
　　　　　　data:[1, -2, 2, 5, 3, 2, 0],
　　　　　　markPoint : {
　　　　　　　　data : [
　　　　　　　　　　{name : '周最低', value : -2, xAxis: 1, yAxis: -1.5}
　　　　　　　　]
　　　　　　},
　　　　　　markLine : {
　　　　　　　　data : [
　　　　　　　　　　{type : 'average', name : '平均值'}
　　　　　　　　]
　　　　　　}
　　　　}
　　]
};
myLineChart.setOption(option2,true);
}

        </script>
{#    </div>#}
{#</div>#}

<hr>

{% endblock %}